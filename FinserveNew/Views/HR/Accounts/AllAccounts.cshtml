@model IEnumerable<FinserveNew.Models.Employee>

@{
    ViewData["Title"] = "Employee List";
    int rowNo = (ViewBag.Page - 1) * ViewBag.PageSize + 1;
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Employee List</h2>
        <a asp-action="Add" class="btn btn-primary"><i class="fas fa-plus me-2"></i>Add New Employee</a>
    </div>

    <div class="card">
        <div class="card-body">
            <form asp-action="AllAccounts" method="get" class="mb-4 row align-items-center" id="searchForm">
                <div class="col-auto input-group flex-grow-1" style="width: auto">
                    <input type="text" name="search" class="form-control" placeholder="Search by name, position or ID..." value="@ViewBag.Search" />
                    <button type="submit" class="btn btn-outline-secondary"><i class="fas fa-search"></i></button>
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#filterModal">
                        <i class="fas fa-filter me-2"></i>Filter
                    </button>
                </div>
                
                <!-- Hidden inputs for pagination and filters -->
                <input type="hidden" name="page" value="1" id="pageInput" />
                <input type="hidden" name="pageSize" value="@ViewBag.PageSize" id="pageSizeInput" />
                <input type="hidden" name="position" value="@ViewBag.Position" id="positionInput" />
                <input type="hidden" name="status" value="@ViewBag.Status" id="statusInput" />
                <input type="hidden" name="joinDateStart" value="@ViewBag.JoinDateStart?.ToString("yyyy-MM-dd")" id="joinDateStartInput" />
                <input type="hidden" name="joinDateEnd" value="@ViewBag.JoinDateEnd?.ToString("yyyy-MM-dd")" id="joinDateEndInput" />
            </form>

            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th style="width: 40px">No</th>
                            <th style="width: 120px">Employee ID</th>
                            <th>Employee Name</th>
                            <th style="width: 130px">Position</th>
                            <th style="width: 130px">Join Date</th>
                            <th style="width: 130px">Status</th>
                            <th style="width: 80px">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@rowNo</td>
                                    <td>@item.EmployeeID</td>
                                    <td>@item.FirstName @item.LastName</td>
                                    <td>@item.Position</td>
                                    <td>@item.JoinDate.ToShortDateString()</td>
                                    <td><span class="badge badge-active">@item.ConfirmationStatus</span></td>
                                    <td class="d-flex justify-content-around">
                                        <div class="btn-group">
                                            <a asp-action="ViewDetails" asp-route-id="@item.EmployeeID" class="btn btn-sm btn-icon"><i class="fas fa-eye"></i></a>
                                        </div>
                                    </td>
                                </tr>
                                rowNo++;
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7" class="text-center text-muted">No employees found.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @if (ViewBag.TotalRecords > 0)
            {
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <div class="d-flex align-items-center">
                        <span class="me-2">Page size:</span>
                        <select class="form-select form-select-sm me-3" style="width: auto;" id="pageSizeSelect" onchange="changePageSize(this.value)">
                            @foreach (var size in ViewBag.PageSizes)
                            {
                                <option value="@size" selected="@(size == ViewBag.PageSize)">@size</option>
                            }
                        </select>
                    </div>
                    <div>
                        <span>Showing @(((ViewBag.Page - 1) * ViewBag.PageSize) + 1) to @(Math.Min(ViewBag.Page * ViewBag.PageSize, ViewBag.TotalRecords)) of @ViewBag.TotalRecords entries</span>
                    </div>
                    <nav>
                        <ul class="pagination pagination-sm mb-0">
                            @{
                                var totalPages = (int)Math.Ceiling(ViewBag.TotalRecords / (double)ViewBag.PageSize);
                                var startPage = Math.Max(1, ViewBag.Page - 2);
                                var endPage = Math.Min(totalPages, startPage + 4);
                                startPage = Math.Max(1, endPage - 4);
                            }
                            <li class="page-item @(ViewBag.Page == 1 ? "disabled" : "")">
                                <a class="page-link" href="javascript:void(0)" onclick="changePage(@(ViewBag.Page - 1))">&lt;</a>
                            </li>
                            @for (int i = startPage; i <= endPage; i++)
                            {
                                <li class="page-item @(i == ViewBag.Page ? "active" : "")">
                                    <a class="page-link" href="javascript:void(0)" onclick="changePage(@i)">@i</a>
                                </li>
                            }
                            <li class="page-item @(ViewBag.Page == totalPages ? "disabled" : "")">
                                <a class="page-link" href="javascript:void(0)" onclick="changePage(@(ViewBag.Page + 1))">&gt;</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            }
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">Filter Employees</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="positionFilter" class="form-label">Position</label>
                    <select id="positionFilter" class="form-select">
                        <option value="">All Positions</option>
                        <option value="Manager" selected="@(ViewBag.Position == "Manager")">Manager</option>
                        <option value="Developer" selected="@(ViewBag.Position == "Developer")">Developer</option>
                        <option value="Designer" selected="@(ViewBag.Position == "Designer")">Designer</option>
                        <option value="Senior" selected="@(ViewBag.Position == "Senior")">Senior</option>
                        <option value="HR" selected="@(ViewBag.Position == "HR")">HR</option>
                        <option value="Assistant" selected="@(ViewBag.Position == "Assistant")">Assistant</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="statusFilter" class="form-label">Status</label>
                    <select id="statusFilter" class="form-select">
                        <option value="">All Statuses</option>
                        <option value="Active" selected="@(ViewBag.Status == "Active")">Active</option>
                        <option value="Probation" selected="@(ViewBag.Status == "Probation")">Probation</option>
                        <option value="Terminated" selected="@(ViewBag.Status == "Terminated")">Terminated</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="joinDateStartFilter" class="form-label">Join Date (From)</label>
                    <input type="date" class="form-control" id="joinDateStartFilter" 
                           value="@ViewBag.JoinDateStart?.ToString("yyyy-MM-dd")" />
                </div>
                
                <div class="mb-3">
                    <label for="joinDateEndFilter" class="form-label">Join Date (To)</label>
                    <input type="date" class="form-control" id="joinDateEndFilter" 
                           value="@ViewBag.JoinDateEnd?.ToString("yyyy-MM-dd")" />
                </div>
                
                @if (ViewBag.Position != null || ViewBag.Status != null || 
                     ViewBag.JoinDateStart != null || ViewBag.JoinDateEnd != null)
                {
                    <div class="alert alert-info">
                        <i class="fas fa-filter me-2"></i>
                        <span>Filters are active</span>
                    </div>
                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" id="clearFiltersBtn">Clear Filters</button>
                <button type="button" class="btn btn-primary" id="applyFiltersBtn">Apply Filters</button>
            </div>
        </div>
    </div>
</div>

<style>
    .pagination .page-item.active .page-link {
        background: #f4f0ff;
        color: #6c4cf1;
        border: 0.5px solid #6c4cf1;
        border-radius: 5px;
        font-weight: 500;
    }
    .pagination .page-link {
        color: #222;
        border: none;
        min-width: 32px;
        text-align: center;
    }

    .pagination .page-item.disabled {
        --bs-pagination-disabled-bg: none;
    }
    
    /* Badge styles - keeping original */
    .badge-active {
        background: rgba(108, 76, 241, 0.1);
        color: #6c4cf1;
        border-radius: 8px;
        font-weight: 500;
        padding: 0.4em 0.8em;
    }
    
    /* Filter modal style */
    .modal-header {
        border-bottom: 1px solid #dee2e6;
        background-color: #f8f9fa;
    }
    
    .modal-footer {
        border-top: 1px solid #dee2e6;
        background-color: #f8f9fa;
    }
</style>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Apply filters button
            $('#applyFiltersBtn').click(function() {
                $('#positionInput').val($('#positionFilter').val());
                $('#statusInput').val($('#statusFilter').val());
                $('#joinDateStartInput').val($('#joinDateStartFilter').val());
                $('#joinDateEndInput').val($('#joinDateEndFilter').val());
                $('#pageInput').val(1); // Reset to first page when applying filters
                $('#searchForm').submit();
            });
            
            // Clear filters button
            $('#clearFiltersBtn').click(function() {
                $('#positionFilter').val('');
                $('#statusFilter').val('');
                $('#joinDateStartFilter').val('');
                $('#joinDateEndFilter').val('');
                
                $('#positionInput').val('');
                $('#statusInput').val('');
                $('#joinDateStartInput').val('');
                $('#joinDateEndInput').val('');
                $('#pageInput').val(1);
                $('#searchForm').submit();
            });
            
            // Show filter indicator
            @if (ViewBag.Position != null || ViewBag.Status != null || 
                 ViewBag.JoinDateStart != null || ViewBag.JoinDateEnd != null)
            {
                <text>
                $('.btn-outline-secondary[data-bs-toggle="modal"]').addClass('active').html('<i class="fas fa-filter me-2"></i>Filter');
                </text>
            }
        });
        
        function changePageSize(size) {
            $('#pageSizeInput').val(size);
            $('#pageInput').val(1); // Reset to first page when changing page size
            $('#searchForm').submit();
        }
        
        function changePage(page) {
            $('#pageInput').val(page);
            $('#searchForm').submit();
        }
    </script>
}
